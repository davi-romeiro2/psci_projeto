<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Psicologia</title>
    <link rel="stylesheet" href="login.css" />
</head>

<body>
    <div class="login-container">
        <!-- Modal de Login -->
        <div id="login-modal">
            <h1>Bem-vindo(a)</h1>
            <form class="login-form">
                <label for="email">Email</label>
                <input type="email" placeholder="Digite seu email" id="email" required />

                <label for="senha">Senha</label>
                <input type="password" placeholder="Digite sua senha" id="senha" required />

                <button type="submit">Entrar</button>

                <a href="#" class="forgot-password" id="forgot-password-link">Esqueci minha senha</a>

                <div class="register-section">
                    <p>Primeiro acesso?</p>
                    <a href="#" id="show-register">Cadastre-se</a>
                </div>
            </form>
        </div>

        <!-- Modal de Cadastro -->
        <div id="register-modal">
            <h2>Cadastro</h2>
            <form class="register-form">
                <div class="age-question-container">
                    <p class="age-question-text">Quantos anos você tem?</p>
                    <div class="checkboxes">
                        <label><input type="checkbox" name="type" value="crianca"> Criança (5–10 anos)</label>
                        <label><input type="checkbox" name="type" value="adolescente"> Adolescente (12–17 anos)</label>
                        <label><input type="checkbox" name="type" value="adulto"> Adulto (+18)</label>
                    </div>
                </div>


                <!-- Criança ou Adolescente -->
                <div id="form-kid-teen" class="hidden">
                    <label>Email</label>
                    <input type="email" placeholder="Digite seu email" required />

                    <label>Email do responsável</label>
                    <input type="email" placeholder="Digite o email do responsável" required />

                    <label>Senha</label>

                    <ul class="password-requirements">
                        <li id="kid-req-uppercase">Uma letra maiúscula</li>
                        <li id="kid-req-special">Um caractere especial (@#$%&*)</li>
                        <li id="kid-req-number">Um número</li>
                        <li id="kid-req-length">No mínimo 8 caracteres</li>
                    </ul>
                    <input type="password" id="password-cadastro-kid" />

                    <label>Idade</label>
                    <input type="number" placeholder="Digite sua idade" required />

                    <label>Gênero</label>
                    <select required>
                        <option value="">Selecione</option>
                        <option>Masculino</option>
                        <option>Feminino</option>
                        <option>Outro</option>
                    </select>

                    <label>Telefone dos responsáveis</label>
                    <input type="tel" placeholder="Digite o telefone dos responsáveis" required />

                    <label>Seu telefone</label>
                    <input type="tel" placeholder="Digite seu telefone (WhatsApp)" required />
                </div>

                <!-- Adulto -->
                <div id="form-adult" class="hidden">
                    <label>Email</label>
                    <input type="email" placeholder="Digite seu email" required />

                    <label>Senha</label>

                    <ul class="password-requirements">
                        <li id="adult-req-uppercase"> Uma letra maiúscula</li>
                        <li id="adult-req-special"> Um caractere especial (@#$%&*)</li>
                        <li id="adult-req-number"> Um número</li>
                        <li id="adult-req-length"> No mínimo 8 caracteres</li>
                    </ul>
                    <input type="password" id="password-cadastro-adult" />

                    <label>Idade</label>
                    <input type="number" placeholder="Digite sua idade" required />

                    <label>Gênero</label>
                    <select required>
                        <option value="">Selecione</option>
                        <option>Masculino</option>
                        <option>Feminino</option>
                        <option>Outro</option>
                    </select>

                    <label>Telefone</label>
                    <input type="tel" placeholder="Digite seu telefone (WhatsApp)" required />
                </div>

                <button type="submit">Cadastrar</button>
                <a href="#" id="voltar-login" class="forgot-password">Voltar ao login</a>
            </form>
        </div>

        <div id="success-register-modal" class="modal hidden"
            style="display:none; position: fixed; top:0; left:0; width:100vw; height:100vh; background: rgba(58,80,61,0.7); justify-content:center; align-items:center; z-index: 1000;">
            <div
                style="background:#fff; padding: 2rem; border-radius: 12px; text-align:center; max-width: 320px; width: 90%;">
                <svg style="width:50px; height:50px; fill: #3A503D; margin-bottom: 1rem;"
                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M9 16.17l-3.5-3.5L4 14.17l5 5 12-12-1.41-1.42z" />
                </svg>
                <h2 style="color:#3A503D;">Cadastro realizado com sucesso!</h2>
                <button id="success-register-ok"
                    style="margin-top: 1rem; padding: 0.5rem 1.5rem; border:none; border-radius: 6px; background:#BB8991; color:#fff; font-weight:bold; cursor:pointer;">OK</button>
            </div>
        </div>

        <!-- Modal Esqueci Senha -->
        <div id="forgot-password-modal" style="display:none; text-align:left;">
            <h2>Esqueci minha senha</h2>
            <form id="forgot-password-form">
                <label for="user-or-email">Nome de usuário ou email</label>
                <input type="text" id="user-or-email" placeholder="Digite seu nome de usuário ou email" required />

                <button type="submit" id="send-email-btn">Enviar email para mudar senha</button>
            </form>

            <form id="verification-code-form" style="display:none; margin-top: 1.5rem;">
                <p>Digite o código de 6 caracteres enviado:</p>
                <div class="code-inputs">
                    <input type="text" maxlength="1" pattern="[a-zA-Z0-9]" inputmode="text" required />
                    <input type="text" maxlength="1" pattern="[a-zA-Z0-9]" inputmode="text" required />
                    <input type="text" maxlength="1" pattern="[a-zA-Z0-9]" inputmode="text" required />
                    <input type="text" maxlength="1" pattern="[a-zA-Z0-9]" inputmode="text" required />
                    <input type="text" maxlength="1" pattern="[a-zA-Z0-9]" inputmode="text" required />
                    <input type="text" maxlength="1" pattern="[a-zA-Z0-9]" inputmode="text" required />
                </div>
            </form>

            <div id="loading-spinner" style="display:none;">
                <div class="spinner"></div>
            </div>

            <form id="new-password-form" style="display: none;">
                <ul id="password-requirements">
                    <li id="req-uppercase">• Pelo menos uma letra maiúscula</li>
                    <li id="req-number">• Pelo menos um número</li>
                    <li id="req-special">• Pelo menos um caractere especial (@#$%&*)</li>
                    <li id="req-length">• Pelo menos 8 caracteres</li>
                </ul>
                <input id="new-password-input" type="password" placeholder="Digite a nova senha" required />
                <button id="update-password-btn">Atualizar senha</button>
            </form>


            <a href="#" id="forgot-back-login" class="forgot-password">Voltar ao login</a>
        </div>

        <!-- Modal de Sucesso -->
        <div id="success-modal" class="modal success-modal" style="display: none;">
            <div class="success-content">
                <div class="success-icon">✅</div>
                <p>Senha alterada com sucesso!</p>
                <button id="success-ok">OK</button>
            </div>
        </div>

    </div>

    <script>
        const loginModal = document.getElementById('login-modal');
        const registerModal = document.getElementById('register-modal');
        const showRegister = document.getElementById('show-register');
        const voltarLogin = document.getElementById('voltar-login');
        const checkboxes = document.querySelectorAll('input[name="type"]');
        const formKidTeen = document.getElementById('form-kid-teen');
        const formAdult = document.getElementById('form-adult');
        const forgotPasswordModal = document.getElementById('forgot-password-modal');
        const forgotPasswordForm = document.getElementById('forgot-password-form');
        const verificationCodeForm = document.getElementById('verification-code-form');
        const codeInputs = verificationCodeForm.querySelectorAll('.code-inputs input');
        const forgotBackLogin = document.getElementById('forgot-back-login');
        const forgotPasswordLink = document.getElementById('forgot-password-link');
        const modalOverlay = document.getElementById('modal-overlay');
        const loadingSpinner = document.getElementById('loading-spinner');
        const newPasswordForm = document.getElementById('new-password-form');
        const successModal = document.getElementById('success-modal');
        const successOk = document.getElementById('success-ok');
        const passwordInput = document.getElementById('new-password-input');
        const updatePasswordButton = document.getElementById('update-password-btn');

        // Modal sucesso cadastro e botão OK
        const successRegisterModal = document.getElementById('success-register-modal');
        const successRegisterOk = document.getElementById('success-register-ok');

        document.getElementById('success-register-ok')?.addEventListener('click', function () {
            successRegisterModal.style.display = 'none';
        });

        // Função para pegar o campo de senha e requisitos ativos no cadastro
        function getActivePasswordField() {
            const kidInput = document.getElementById('password-cadastro-kid');
            const adultInput = document.getElementById('password-cadastro-adult');

            if (kidInput && !kidInput.closest('.hidden')) {
                return {
                    input: kidInput,
                    reqUppercase: document.getElementById('kid-req-uppercase'),
                    reqSpecial: document.getElementById('kid-req-special'),
                    reqNumber: document.getElementById('kid-req-number'),
                    reqLength: document.getElementById('kid-req-length'),
                };
            }

            if (adultInput && !adultInput.closest('.hidden')) {
                return {
                    input: adultInput,
                    reqUppercase: document.getElementById('adult-req-uppercase'),
                    reqSpecial: document.getElementById('adult-req-special'),
                    reqNumber: document.getElementById('adult-req-number'),
                    reqLength: document.getElementById('adult-req-length'),
                };
            }

            return null;
        }

        // Validação senha cadastro (dinâmica para o formulário ativo)
        function validatePasswordCadastro() {
            const active = getActivePasswordField();
            if (!active) return false;

            const password = active.input.value;
            let isValid = true;

            if (/[A-Z]/.test(password)) {
                active.reqUppercase.style.color = 'green';
            } else {
                active.reqUppercase.style.color = 'red';
                isValid = false;
            }

            if (/[@#$%&*]/.test(password)) {
                active.reqSpecial.style.color = 'green';
            } else {
                active.reqSpecial.style.color = 'red';
                isValid = false;
            }

            if (/[0-9]/.test(password)) {
                active.reqNumber.style.color = 'green';
            } else {
                active.reqNumber.style.color = 'red';
                isValid = false;
            }

            if (password.length >= 8) {
                active.reqLength.style.color = 'green';
            } else {
                active.reqLength.style.color = 'red';
                isValid = false;
            }

            return isValid;
        }

        document.getElementById('password-cadastro-kid')?.addEventListener('input', function () {
            validatePasswordCadastro();
        });

        document.getElementById('password-cadastro-adult')?.addEventListener('input', function () {
            validatePasswordCadastro();
        });

        // Adiciona listener ao campo senha ativo quando muda seleção de idade
        function attachPasswordInputListener() {
            const active = getActivePasswordField();
            if (!active) return;

            // Remove listeners anteriores para evitar duplicidade
            active.input.removeEventListener('input', validatePasswordCadastro);
            active.input.addEventListener('input', validatePasswordCadastro);

            // Executa uma validação imediata para atualizar cores
            validatePasswordCadastro();
        }

        // Ao mudar checkbox, exibe form correto e liga evento de senha
        checkboxes.forEach(box => {
            box.addEventListener('change', () => {
                checkboxes.forEach(b => {
                    if (b !== box) b.checked = false;
                });

                if (box.checked) {
                    if (box.value === "crianca" || box.value === "adolescente") {
                        formKidTeen.classList.remove("hidden");
                        formAdult.classList.add("hidden");
                    } else if (box.value === "adulto") {
                        formAdult.classList.remove("hidden");
                        formKidTeen.classList.add("hidden");
                    }
                } else {
                    formKidTeen.classList.add("hidden");
                    formAdult.classList.add("hidden");
                }

                attachPasswordInputListener();
            });
        });

        // Captura o form cadastro
        const registerForm = document.querySelector('#register-modal form.register-form');

        // Submit cadastro
        registerForm.addEventListener('submit', function (e) {
            e.preventDefault();

            const isValid = validatePasswordCadastro();

            if (!isValid) {
                alert('A senha não atende aos requisitos.');
                return;
            }

            // Aqui você pode enviar os dados para backend...

            // Mostrar modal sucesso cadastro
            successRegisterModal.style.display = 'flex';
        });

        // Botão OK modal sucesso cadastro
        successRegisterOk.addEventListener('click', () => {
            successRegisterModal.style.display = 'none';

            // Fecha modal cadastro e abre login
            registerModal.style.display = 'none';
            loginModal.style.display = 'block';

            if (modalOverlay) modalOverlay.style.display = 'none';

            // Limpar formulário e resetar cores requisitos
            registerForm.reset();

            // Reset cores requisitos para ambos os formulários (criança e adulto)
            ['kid', 'adult'].forEach(prefix => {
                document.getElementById(`uppercase-cadastro-${prefix}`).style.color = 'red';
                document.getElementById(`special-cadastro-${prefix}`).style.color = 'red';
                document.getElementById(`number-cadastro-${prefix}`).style.color = 'red';
                document.getElementById(`length-cadastro-${prefix}`).style.color = 'red';
            });
        });

        // Validação senha nova (esqueci senha)
        const reqUppercase = document.getElementById('req-uppercase');
        const reqNumber = document.getElementById('req-number');
        const reqSpecial = document.getElementById('req-special');
        const reqLength = document.getElementById('req-length');

        function validatePassword() {
            const password = passwordInput.value;
            let isValid = true;

            if (/[A-Z]/.test(password)) {
                reqUppercase.style.color = 'green';
            } else {
                reqUppercase.style.color = 'red';
                isValid = false;
            }

            if (/[0-9]/.test(password)) {
                reqNumber.style.color = 'green';
            } else {
                reqNumber.style.color = 'red';
                isValid = false;
            }

            if (/[@#$%&*]/.test(password)) {
                reqSpecial.style.color = 'green';
            } else {
                reqSpecial.style.color = 'red';
                isValid = false;
            }

            if (password.length >= 8) {
                reqLength.style.color = 'green';
            } else {
                reqLength.style.color = 'red';
                isValid = false;
            }

            return isValid;
        }

        passwordInput.addEventListener('input', validatePassword);

        // Botão atualizar senha no "esqueci senha"
        updatePasswordButton.addEventListener('click', (e) => {
            e.preventDefault();

            if (passwordInput.value.trim() === '') {
                alert("Digite uma nova senha.");
                return;
            }

            const isValid = validatePassword();

            if (isValid) {
                successModal.style.display = 'flex';
            } else {
                alert("A senha não atende aos requisitos.");
                successModal.style.display = 'none';
            }
        });

        // Botão OK modal sucesso nova senha
        if (successOk) {
            successOk.addEventListener('click', () => {
                successModal.style.display = 'none';
                forgotPasswordModal.style.display = 'none';
                loginModal.style.display = 'block';
                if (modalOverlay) modalOverlay.style.display = 'none';
            });
        }

        // Código verificação "esqueci senha"
        function checkCodeComplete() {
            const allFilled = Array.from(codeInputs).every(input => input.value.length === 1);

            if (allFilled) {
                newPasswordForm.style.display = 'none';
                loadingSpinner.style.display = 'flex';

                setTimeout(() => {
                    loadingSpinner.style.display = 'none';
                    newPasswordForm.style.display = 'block';
                    newPasswordForm.querySelector('input').focus();
                }, 3000);
            } else {
                loadingSpinner.style.display = 'none';
                newPasswordForm.style.display = 'none';
            }
        }

        codeInputs.forEach(input => {
            input.addEventListener('input', checkCodeComplete);
            input.addEventListener('keydown', () => {
                setTimeout(checkCodeComplete, 0);
            });

            input.addEventListener('keydown', (e) => {
                const index = Array.from(codeInputs).indexOf(input);
                if (e.key === 'Backspace' && input.value === '' && index > 0) {
                    codeInputs[index - 1].focus();
                }
            });

            input.addEventListener('input', () => {
                const index = Array.from(codeInputs).indexOf(input);
                if (input.value.length > 0 && index < codeInputs.length - 1) {
                    codeInputs[index + 1].focus();
                } else if (index === codeInputs.length - 1) {
                    input.blur();
                }
            });
        });

        // Abrir modal "Esqueci minha senha"
        forgotPasswordLink.addEventListener('click', (e) => {
            e.preventDefault();
            loginModal.style.display = 'none';
            registerModal.style.display = 'none';
            forgotPasswordModal.style.display = 'block';
            if (modalOverlay) modalOverlay.style.display = 'block';
        });

        // Enviar email "esqueci senha"
        forgotPasswordForm.addEventListener('submit', (e) => {
            e.preventDefault();
            forgotPasswordForm.style.display = 'none';
            verificationCodeForm.style.display = 'block';
            codeInputs[0].focus();
        });

        // Voltar ao login (esqueci senha)
        forgotBackLogin.addEventListener('click', (e) => {
            e.preventDefault();
            forgotPasswordModal.style.display = 'none';
            registerModal.style.display = 'none';
            loginModal.style.display = 'block';
            if (modalOverlay) modalOverlay.style.display = 'none';
        });

        // Mostrar modal cadastro
        showRegister.addEventListener('click', (e) => {
            e.preventDefault();
            loginModal.style.display = 'none';
            registerModal.style.display = 'block';
            if (modalOverlay) modalOverlay.style.display = 'block';
        });

        // Voltar ao login (cadastro)
        voltarLogin.addEventListener('click', (e) => {
            e.preventDefault();
            registerModal.style.display = 'none';
            loginModal.style.display = 'block';
            if (modalOverlay) modalOverlay.style.display = 'none';
        });

        // Inicializa listener no campo senha correto no carregamento da página (se algum formulário estiver aberto)
        attachPasswordInputListener();
    </script>


</body>

</html>